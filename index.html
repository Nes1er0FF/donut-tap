<!DOCTYPE html>
<html>
<head>
    <title>Donut Tap v0.5</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { 
            background: #418CD8FF;
            color: #000000;
            font-family: monospace;
            text-align: center;
            padding: 0;
            overflow: hidden;
            margin: 0;
        }
        #score {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 2rem;
            margin: 20px 0 0 0;
        }
        #donut-icon {
            width: 64px;
            height: 64px;
            image-rendering: pixelated;
        }
        #donut {
            background: url('./images/donut_sprite.png') center/contain no-repeat;
            width: 300px;
            height: 300px;
            position: fixed;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            image-rendering: pixelated;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        /* –°—Ç–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        #settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 1000;
            image-rendering: pixelated;
        }
        
        /* –ù–û–í–´–ï –ö–ù–û–ü–ö–ò –í–ù–ò–ó–£ */
        .bottom-btn {
            position: fixed;
            bottom: 20px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 1000;
            image-rendering: pixelated;
            -webkit-tap-highlight-color: transparent;
        }
        
        #upgrades-btn { 
            left: 20px; 
        }
        
        #info-btn { 
            right: 20px; 
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–æ–±—â–∏–µ —Å—Ç–∏–ª–∏) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
        }
        
        .modal-window {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: url('images/menu_background.png') center/contain no-repeat;
            image-rendering: pixelated;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        #settings-window {
            width: 300px;
            height: 200px;
        }
        
        /* –ù–û–í–û–ï: –û–∫–Ω–æ —É–ª—É—á—à–µ–Ω–∏–π –±–æ–ª—å—à–µ */
        #upgrades-window {
            width: 320px;
            min-height: 300px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            image-rendering: pixelated;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            color: white;
            font-size: 20px;
            cursor: pointer;
            image-rendering: pixelated;
        }
        
        .setting-icon {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–ô */
        .upgrade-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            box-sizing: border-box;
        }

        .upgrade-item:active {
            transform: scale(0.98);
        }

        .upgrade-icon {
            width: 48px;
            height: 48px;
            image-rendering: pixelated;
            flex-shrink: 0;
        }

        .upgrade-info {
            flex-grow: 1;
            margin-left: 12px;
            text-align: left;
            color: white;
        }

        .upgrade-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .upgrade-description {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .upgrade-price {
            font-size: 14px;
            color: #ffd700;
        }

        .upgrade-status {
            font-size: 14px;
            color: #90ee90;
            flex-shrink: 0;
            margin-left: 10px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes jump {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -60%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .jump-animation {
            animation: jump 0.3s ease-in-out;
        }
        
        #particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        .particle {
            position: absolute;
            width: 32px;
            height: 32px;
            background-size: contain;
            background-repeat: no-repeat;
            image-rendering: pixelated;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            opacity: 1;
        }

        /* –£–±–∏—Ä–∞–µ–º —Å–∏–Ω—é—é –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —Ç–∞–ø–µ –Ω–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö */
        #settings-btn, 
        .bottom-btn,
        .close-icon,
        .setting-row,
        .setting-icon,
        .upgrade-item {
            -webkit-tap-highlight-color: transparent;
            tap-highlight-color: transparent;
            outline: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* –î–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å */
        .setting-row:active,
        .upgrade-item:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div id="score">
        <img id="donut-icon" src="images/mini_donut.png" alt="üç©">
        <span id="score-text">0</span>
    </div>
    
    <div id="donut"></div>
    <div id="particles-container"></div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <img id="settings-btn" src="images/settings_icon.png" alt="‚öôÔ∏è">
    
    <!-- –ù–û–í–´–ï –ö–ù–û–ü–ö–ò –í–ù–ò–ó–£ -->
    <img id="upgrades-btn" src="images/upgrades_icon.png" class="bottom-btn" alt="üõ†Ô∏è">
    <img id="info-btn" src="images/info_icon.png" class="bottom-btn" alt="‚ÑπÔ∏è">
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settings-modal" class="modal">
        <div id="settings-window" class="modal-window">
            <img id="close-btn" src="images/close_icon.png" class="close-icon" alt="‚úï">
            
            <div class="setting-row" id="music-setting">
                <img id="music-icon" src="images/music_on.png" class="setting-icon" alt="üéµ">
                <span>–ú—É–∑—ã–∫–∞</span>
            </div>
            
            <div class="setting-row" id="sound-setting">
                <img id="sound-icon" src="images/sound_on.png" class="setting-icon" alt="üîä">
                <span>–ó–≤—É–∫–∏</span>
            </div>
        </div>
    </div>

    <!-- –ù–û–í–û–ï: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ª—É—á—à–µ–Ω–∏–π -->
    <div id="upgrades-modal" class="modal">
        <div id="upgrades-window" class="modal-window">
            <img id="close-upgrades" src="images/close_icon.png" class="close-icon" alt="‚úï">
            
            <div class="upgrade-item" data-id="chef">
                <img src="images/chef_upgrade.png" class="upgrade-icon" alt="üë®‚Äçüç≥">
                <div class="upgrade-info">
                    <div class="upgrade-title">–ü–æ–≤–∞—Ä</div>
                    <div class="upgrade-description">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç: 4/—Å–µ–∫ (–í—Å–µ–≥–æ: +0/—Å–µ–∫)</div>                           
                    <div class="upgrade-price">–¶–µ–Ω–∞: 50 –ø–æ–Ω—á–∏–∫–æ–≤</div>
                </div>
                <div class="upgrade-status">–£—Ä: 0</div>
            </div>
            
            <!-- –ú–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∑–∂–µ -->
        </div>
    </div>

    <script>
        // === –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
        let score = 0;
        let musicEnabled = true;
        let soundsEnabled = true;
        
        // –ù–û–í–û–ï: –°–∏—Å—Ç–µ–º–∞ —É–ª—É—á—à–µ–Ω–∏–π
        let upgrades = {
    chef: { 
        owned: 0,           // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø–æ–≤–∞—Ä–æ–≤
        basePrice: 50,      // –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–≤–∞—Ä–∞
        production: 4       // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –æ–¥–Ω–æ–≥–æ –ø–æ–≤–∞—Ä–∞ (4 –ø–æ–Ω—á–∏–∫–∞/—Å–µ–∫)
    }
    };
        
        let passiveIncome = 0; // –°–∫–æ–ª—å–∫–æ –ø–æ–Ω—á–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º
        
        const scoreDisplay = document.getElementById("score-text");
        const donut = document.getElementById("donut");
        const settingsBtn = document.getElementById("settings-btn");
        const settingsModal = document.getElementById("settings-modal");
        const closeBtn = document.getElementById("close-btn");
        const musicIcon = document.getElementById("music-icon");
        const soundIcon = document.getElementById("sound-icon");
        const musicSetting = document.getElementById("music-setting");
        const soundSetting = document.getElementById("sound-setting");

        // –ù–û–í–û–ï: –≠–ª–µ–º–µ–Ω—Ç—ã —É–ª—É—á—à–µ–Ω–∏–π
        const upgradesBtn = document.getElementById("upgrades-btn");
        const upgradesModal = document.getElementById("upgrades-modal");
        const closeUpgrades = document.getElementById("close-upgrades");
        const chefUpgrade = document.querySelector('[data-id="chef"]');

        // –ö–û–ù–°–¢–ê–ù–¢–ê –¥–ª—è —Å–ø—Ä–∞–π—Ç–∞ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
        const DONUT_SPRITE_URL = "url('./images/donut_sprite.png')";

        // === –§–£–ù–ö–¶–ò–ò –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø ===
        function formatNumber(num) {
            if (num < 1000) return num.toString();
            const suffixes = ["", "K", "M", "B", "T", "Qa", "Qi"];
            const tier = Math.floor(Math.log10(num) / 3);
            if (tier >= suffixes.length) return "‚àû";
            const scaled = num / Math.pow(1000, tier);
            const formatted = scaled % 1 === 0 ? scaled.toFixed(0) : scaled.toFixed(1);
            return formatted + suffixes[tier];
        }

        // === –°–ò–°–¢–ï–ú–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø ===
        function loadSave() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—á—ë—Ç
            const savedScore = localStorage.getItem("donutTap_score");
            if (savedScore) {
                score = parseInt(savedScore);
                scoreDisplay.textContent = formatNumber(score);
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const savedMusic = localStorage.getItem("donutTap_music");
            const savedSounds = localStorage.getItem("donutTap_sounds");
            
            if (savedMusic !== null) musicEnabled = savedMusic === 'true';
            if (savedSounds !== null) soundsEnabled = savedSounds === 'true';
            
            // –ù–û–í–û–ï: –ó–∞–≥—Ä—É–∂–∞–µ–º —É–ª—É—á—à–µ–Ω–∏—è
            loadUpgrades();
            
            updateSettingsIcons();
        }

        function saveProgress() {
            localStorage.setItem("donutTap_score", score.toString());
        }
        
        function saveSettings() {
            localStorage.setItem("donutTap_music", musicEnabled.toString());
            localStorage.setItem("donutTap_sounds", soundsEnabled.toString());
        }
        
        // –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π
        function saveUpgrades() {
            localStorage.setItem("donutTap_upgrades", JSON.stringify(upgrades));
        }
        
        function loadUpgrades() {
            const saved = localStorage.getItem("donutTap_upgrades");
            if (saved) {
                upgrades = JSON.parse(saved);
                calculatePassiveIncome();
                updateUpgradesDisplay();
            }
        }
        
        function updateSettingsIcons() {
            musicIcon.src = musicEnabled ? 'images/music_on.png' : 'images/music_off.png';
            soundIcon.src = soundsEnabled ? 'images/sound_on.png' : 'images/sound_off.png';
        }

        // === –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–¶ ===
        function createParticle(x, y) {
            const container = document.getElementById('particles-container');
            const particle = document.createElement('div');
            
            particle.className = 'particle';
            particle.style.backgroundImage = DONUT_SPRITE_URL;
            particle.style.left = (x - 16) + 'px';
            particle.style.top = (y - 16) + 'px';
            
            const angle = Math.random() * Math.PI * 2;
            const distance = 50 + Math.random() * 80;
            const targetX = x + Math.cos(angle) * distance;
            const targetY = y + Math.sin(angle) * distance;
            
            container.appendChild(particle);
            
            setTimeout(() => {
                particle.style.transform = `translate(${targetX - x}px, ${targetY - y}px)`;
                particle.style.opacity = '0';
            }, 10);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 500);
        }

        // === –°–ò–°–¢–ï–ú–ê –ó–í–£–ö–û–í ===
        const tapSounds = [
            'sounds/tap1.mp3',
            'sounds/tap2.mp3',
            'sounds/tap3.mp3',
            'sounds/tap4.mp3',
            'sounds/tap5.mp3',
            'sounds/tap6.mp3',
            'sounds/tap7.mp3'
        ];

        function playTapSound() {
            if (!soundsEnabled) return;
            
            const randomSound = tapSounds[Math.floor(Math.random() * tapSounds.length)];
            const audio = new Audio(randomSound);
            audio.volume = 0.3;
            audio.play().catch(e => {
                console.log("Audio play failed:", e);
                // –ï—Å–ª–∏ –∑–≤—É–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –æ—Ç–∫–ª—é—á–∞–µ–º –∏—Ö
                soundsEnabled = false;
                saveSettings();
                updateSettingsIcons();
            });
        }

        // === –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê: –ü–ê–°–°–ò–í–ù–´–ô –î–û–•–û–î ===
        function calculatePassiveIncome() {
    // –ö–∞–∂–¥—ã–π –ø–æ–≤–∞—Ä –¥–∞–µ—Ç 4 –ø–æ–Ω—á–∏–∫–∞/—Å–µ–∫
    passiveIncome = upgrades.chef.owned * upgrades.chef.production;
    return passiveIncome;
        }

        function updatePassiveIncome() {
            if (passiveIncome > 0) {
                score += passiveIncome;
                scoreDisplay.textContent = formatNumber(score);
                saveProgress();
            }
        }

        // === –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê: –£–õ–£–ß–®–ï–ù–ò–Ø ===
        function buyUpgrade(upgradeId) {
    const upgrade = upgrades[upgradeId];
    
    // –¶–µ–Ω–∞ —Ä–∞—Å—Ç–µ—Ç –Ω–∞ 20% —Å –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–æ–π (–∫–∞–∫ –≤ Cookie Clicker)
    const price = Math.floor(upgrade.basePrice * Math.pow(1.15, upgrade.owned));
    
    if (score >= price) {
        score -= price;
        upgrade.owned++;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        scoreDisplay.textContent = formatNumber(score);
        updateUpgradesDisplay();
        calculatePassiveIncome();
        saveProgress();
        saveUpgrades();
        
        console.log(`–ö—É–ø–ª–µ–Ω –ø–æ–≤–∞—Ä ‚Ññ${upgrade.owned}. –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ: +${upgrade.production}/—Å–µ–∫`);
    }
        }

        function updateUpgradesDisplay() {
    if (chefUpgrade) {
        const chef = upgrades.chef;
        const nextPrice = Math.floor(chef.basePrice * Math.pow(1.15, chef.owned));
        const totalProduction = chef.owned * chef.production;
        
        chefUpgrade.querySelector('.upgrade-status').textContent = 
            `–ö—É–ø–ª–µ–Ω–æ: ${chef.owned}`;
        chefUpgrade.querySelector('.upgrade-price').textContent = 
            `–¶–µ–Ω–∞: ${formatNumber(nextPrice)}`;
        chefUpgrade.querySelector('.upgrade-description').textContent = 
            `–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç: ${chef.production}/—Å–µ–∫ (–í—Å–µ–≥–æ: +${totalProduction}/—Å–µ–∫)`;
        
        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç, –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥
        const canAfford = score >= nextPrice;
        chefUpgrade.style.opacity = canAfford ? '1' : '0.6';
    }
        }

        // === –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ===
        function tap(event) {
            score++;
            scoreDisplay.textContent = formatNumber(score);
            saveProgress();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–Ω—á–∏–∫–∞
            donut.classList.remove("jump-animation");
            void donut.offsetWidth; // –¢—Ä–∏–≥–≥–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
            donut.classList.add("jump-animation");
            
            createParticle(event.clientX, event.clientY);
            playTapSound();
        }

        // === –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ===
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        settingsBtn.addEventListener('click', () => {
            settingsModal.style.display = 'block';
        });

        closeBtn.addEventListener('click', () => {
            settingsModal.style.display = 'none';
        });

        musicSetting.addEventListener('click', () => {
            musicEnabled = !musicEnabled;
            saveSettings();
            updateSettingsIcons();
        });

        soundSetting.addEventListener('click', () => {
            soundsEnabled = !soundsEnabled;
            saveSettings();
            updateSettingsIcons();
        });

        // –ù–û–í–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò: –£–ª—É—á—à–µ–Ω–∏—è
        upgradesBtn.addEventListener('click', () => {
            upgradesModal.style.display = 'block';
            updateUpgradesDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        });

        closeUpgrades.addEventListener('click', () => {
            upgradesModal.style.display = 'none';
        });

        chefUpgrade.addEventListener('click', function() {
            buyUpgrade('chef');
        });

        // === –ó–ê–ü–£–°–ö –ò–ì–†–´ ===
        donut.addEventListener("click", tap);
        loadSave();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
        setInterval(updatePassiveIncome, 1000);
    </script>
</body>
</html>
