<!DOCTYPE html>
<html>
<head>
    <title>Donut Tap v0.4</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { 
            background: #418CD8FF;
            color: #000000;
            font-family: monospace;
            text-align: center;
            padding: 0;
            overflow: hidden;
            margin: 0;
        }
        #score {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 2rem;
            margin: 20px 0 0 0;
        }
        #donut-icon {
            width: 64px;
            height: 64px;
            image-rendering: pixelated;
        }
        #donut {
            background: url('https://nes1er0ff.github.io/donut-tap/images/donut_sprite.png') center/contain no-repeat;
            width: 300px;
            height: 300px;
            position: fixed;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            image-rendering: pixelated;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        /* –°—Ç–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        #settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 1000;
            image-rendering: pixelated;
        }
        
        #settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
        }
        
        #settings-window {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 200px;
            background: url('images/menu_background.png') center/contain no-repeat;
            image-rendering: pixelated;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .close-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            image-rendering: pixelated;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            color: white;
            font-size: 20px;
            cursor: pointer;
            image-rendering: pixelated;
        }
        
        .setting-icon {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes jump {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -60%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .jump-animation {
            animation: jump 0.3s ease-in-out;
        }
        
        #particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        .particle {
            position: absolute;
            width: 32px;
            height: 32px;
            background-size: contain;
            background-repeat: no-repeat;
            image-rendering: pixelated;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            opacity: 1;
        }
        /* –£–±–∏—Ä–∞–µ–º —Å–∏–Ω—é—é –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —Ç–∞–ø–µ –Ω–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö */
        #settings-btn, 
        #close-btn,
        .setting-row,
        .setting-icon {
            -webkit-tap-highlight-color: transparent;
            tap-highlight-color: transparent;
            outline: none;
            -webkit-user-select: none;
            user-select: none;
        }

/* –î–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å */
         .setting-row:active {
            transform: scale(0.95); /* –õ—ë–≥–∫–æ–µ –Ω–∞–∂–∞—Ç–∏–µ */
        }
    </style>
</head>
<body>
    <div id="score">
        <img id="donut-icon" src="images/mini_donut.png" alt="üç©">
        <span id="score-text">0</span>
    </div>
    
    <div id="donut"></div>
    <div id="particles-container"></div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <img id="settings-btn" src="images/settings_icon.png" alt="‚öôÔ∏è">
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settings-modal">
        <div id="settings-window">
            <img id="close-btn" src="images/close_icon.png" class="close-icon" alt="‚úï">
            
            <div class="setting-row" id="music-setting">
                <img id="music-icon" src="images/music_on.png" class="setting-icon" alt="üéµ">
                <span>–ú—É–∑—ã–∫–∞</span>
            </div>
            
            <div class="setting-row" id="sound-setting">
                <img id="sound-icon" src="images/sound_on.png" class="setting-icon" alt="üîä">
                <span>–ó–≤—É–∫–∏</span>
            </div>
        </div>
    </div>

    <script>
        // === –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
        let score = 0;
        let musicEnabled = true;
        let soundsEnabled = true;
        
        const scoreDisplay = document.getElementById("score-text");
        const donut = document.getElementById("donut");
        const settingsBtn = document.getElementById("settings-btn");
        const settingsModal = document.getElementById("settings-modal");
        const closeBtn = document.getElementById("close-btn");
        const musicIcon = document.getElementById("music-icon");
        const soundIcon = document.getElementById("sound-icon");
        const musicSetting = document.getElementById("music-setting");
        const soundSetting = document.getElementById("sound-setting");

        // === –§–£–ù–ö–¶–ò–ò –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø ===
        function formatNumber(num) {
            if (num < 1000) return num.toString();
            const suffixes = ["", "K", "M", "B", "T"];
            const tier = Math.floor(Math.log10(num) / 3);
            if (tier >= suffixes.length) return "‚àû";
            const scaled = num / Math.pow(1000, tier);
            const formatted = scaled % 1 === 0 ? scaled.toFixed(0) : scaled.toFixed(1);
            return formatted + suffixes[tier];
        }

        // === –°–ò–°–¢–ï–ú–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø ===
        function loadSave() {
            const savedScore = localStorage.getItem("donutTap_score");
            if (savedScore) {
                score = parseInt(savedScore);
                scoreDisplay.textContent = formatNumber(score);
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const savedMusic = localStorage.getItem("donutTap_music");
            const savedSounds = localStorage.getItem("donutTap_sounds");
            
            if (savedMusic !== null) musicEnabled = savedMusic === 'true';
            if (savedSounds !== null) soundsEnabled = savedSounds === 'true';
            
            updateSettingsIcons();
        }

        function saveProgress() {
            localStorage.setItem("donutTap_score", score.toString());
        }
        
        function saveSettings() {
            localStorage.setItem("donutTap_music", musicEnabled.toString());
            localStorage.setItem("donutTap_sounds", soundsEnabled.toString());
        }
        
        function updateSettingsIcons() {
            musicIcon.src = musicEnabled ? 'images/music_on.png' : 'images/music_off.png';
            soundIcon.src = soundsEnabled ? 'images/sound_on.png' : 'images/sound_off.png';
        }

        // === –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–¶ ===
        function createParticle(x, y) {
            const container = document.getElementById('particles-container');
            const particle = document.createElement('div');
            
            particle.className = 'particle';
            particle.style.backgroundImage = getComputedStyle(donut).backgroundImage;
            particle.style.left = (x - 16) + 'px';
            particle.style.top = (y - 16) + 'px';
            
            const angle = Math.random() * Math.PI * 2;
            const distance = 50 + Math.random() * 80;
            const targetX = x + Math.cos(angle) * distance;
            const targetY = y + Math.sin(angle) * distance;
            
            container.appendChild(particle);
            
            setTimeout(() => {
                particle.style.transform = `translate(${targetX - x}px, ${targetY - y}px)`;
                particle.style.opacity = '0';
            }, 10);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 500);
        }

        // === –°–ò–°–¢–ï–ú–ê –ó–í–£–ö–û–í ===
        const tapSounds = [
            'sounds/tap1.mp3',
            'sounds/tap2.mp3',
            'sounds/tap3.mp3',
            'sounds/tap4.mp3',
            'sounds/tap5.mp3',
            'sounds/tap6.mp3',
            'sounds/tap7.mp3'
        ];

        function playTapSound() {
            if (!soundsEnabled) return;
            
            const randomSound = tapSounds[Math.floor(Math.random() * tapSounds.length)];
            const audio = new Audio(randomSound);
            audio.volume = 0.3;
            audio.play().catch(e => console.log("Audio play failed:", e));
        }

        // === –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ===
        function tap(event) {
            score++;
            scoreDisplay.textContent = formatNumber(score);
            saveProgress();
            
            donut.classList.remove("jump-animation");
            void donut.offsetWidth;
            donut.classList.add("jump-animation");
            
            createParticle(event.clientX, event.clientY);
            playTapSound();
        }

        // === –ù–ê–°–¢–†–û–ô–ö–ò ===
        settingsBtn.addEventListener('click', () => {
            settingsModal.style.display = 'block';
        });

        closeBtn.addEventListener('click', () => {
            settingsModal.style.display = 'none';
        });

        musicSetting.addEventListener('click', () => {
            musicEnabled = !musicEnabled;
            saveSettings();
            updateSettingsIcons();
            // –ó–¥–µ—Å—å –ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–æ–π
        });

        soundSetting.addEventListener('click', () => {
            soundsEnabled = !soundsEnabled;
            saveSettings();
            updateSettingsIcons();
        });

        // === –ó–ê–ü–£–°–ö –ò–ì–†–´ ===
        donut.addEventListener("click", tap);
        loadSave();
    </script>
</body>
</html>
